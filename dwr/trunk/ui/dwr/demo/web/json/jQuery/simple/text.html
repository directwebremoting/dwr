<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Simple Text Generation Demo - JSONP</title>
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
  <script type='text/javascript' src='../jquery-1.3.2.min.js'> </script>
  <script type='text/javascript' src='../../../dwr/util.js'> </script>
  <script type='text/javascript' src='text.js'> </script>
  <script type='text/javascript' src='../../../tabs/tabs.js'> </script>
  <link rel="stylesheet" type="text/css" href="../../../tabs/tabs.css" />
  <link rel="stylesheet" type="text/css" href="../../../generic.css" />
  <script>
  function init() {
	  Tabs.init('tabList', 'tabContents');	  
  } 
  </script>
</head>
<body onload="init();">
<div id="page-title">[
  <a href="http://getahead.org/dwr/">DWR Website</a> |
  <a href="../../../">Web Application Index</a>
]</div>

<h1>Dynamically Updating Text - JSONP</h1>

<p>This is a simple demonstration of how to dynamically update a web-page with
text fetched from a web server.</p>

<ul id="tabList">
  <li><a href="#" tabId="demoDiv">Demo</a></li>
  <li><a href="#" tabId="explainDiv">How it works</a></li>
  <li><a href="#" tabId="sourceDiv">Source</a></li>
</ul>

<div id="tabContents">
  <div id="demoDiv">
    <p>
      Name:
      <input type="text" id="demoName" value="Joe"/>
      <input type="button" id="demoSend" value="Send" onclick="update()"/>
      <br/>
      Reply: <span id="demoReply" style="background:#eeffdd; padding-left:4px; padding-right:4px;">&nbsp;</span>
    </p>
  </div>

  <div id="explainDiv">
    <p>When you click on the "Send" button the browser calls the onclick event,
    which calls the <code>update()</code> function:</p>
    
<pre>
 function update() {
    var name = dwr.util.getValue(&quot;demoName&quot;);
    $.post(&quot;../../../dwr/jsonp/Demo/sayHello/&quot; + name, {},
	function(data) {
	    dwr.util.setValue(&quot;demoReply&quot;, data.reply);
        }, &quot;jsonp&quot;); 
    }  
 }</pre>

    <p><code>dwr.util.getValue()</code> is a utility to get the value of any
    element, in this case an input field, but it could be a div or a select
    box.</p>

    <p>The next line is using the <a href="http://docs.jquery.com/Ajax/jQuery.post#urldatacallbacktype" target="new">jQuery post function</a> to make an asynchronous call to the server utilizing DWR's JSON capabilities. The first parameter is the URL for DWR's JSON service. The URL can be broken down as follows:<ul><li>../../dwr/ - The path to the DWR servlet.</li><li>jsonp - Tells DWR to use JSONP.</li><li>Demo - The name of the class you have exposed to DWR.</li><li>sayHello - The name of the method you would like to call on the exposed class</li></ul>The third parameter is the callback function and will be invoked when the remote call returns.  The first parameter of the callback function (in this case "data") will contain the data returned from the remote call.</p>
    
    <p>The result of the $.post function is that DWR will call  the <code>Demo.sayHello()</code> Java method:</p>
    
<pre>
public String sayHello(String name) {
    return "Hello, " + name;
}
</pre>
    
    <p>When the callback function is reached we call <code>dwr.util.setValue()</code> which is a utility that takes the data you pass in
    the second parameter and works out how to fit it to go into the HTML element
    specified by id in the first parameter. This function is one of several neat
    Javascript utilities that make working with DWR much easier.</p>

    
    
  </div>

  <div id="sourceDiv">

<h2>HTML source:</h2>
<pre>
&lt;p&gt;
  Name:
  &lt;input type="text" id="demoName"/&gt;
  &lt;input value="Send" type="button" onclick="update()"/&gt;
  &lt;br/&gt;
  Reply: &lt;span id="demoReply"&gt;&lt;/span&gt;
&lt;/p&gt;
</pre>

<h2>Javascript source:</h2>
<pre>
  function update() {
      var name = dwr.util.getValue(&quot;demoName&quot;);
      $.post(&quot;../../../dwr/jsonp/Demo/sayHello/&quot; + name, { },
          function(data) {
              dwr.util.setValue(&quot;demoReply&quot;, data.reply);
          }, &quot;jsonp&quot;); 
      } 
  }</pre>

<h2>Java source:</h2>
<pre>
package org.getahead.dwrdemo.simpletext;

public class Demo {
    public String sayHello(String name) {
        return "Hello, " + name;
    }
}
</pre>
<h2>web.xml</h2>
      <p>Note: In order to enable JSON/JSONP you must add the following init-param to your DWR servlet definition in your web.xml (This is a snippet and is not a complete web.xml).<pre><code>
   ...
  &lt;servlet&gt;
    &lt;servlet-name>dwr-invoker&lt;/servlet-name&gt;
    &lt;display-name>DWR Servlet&lt;/display-name&gt;
    &lt;description>Direct Web Remoter Servlet&lt;/description&gt;
    &lt;servlet-class>org.directwebremoting.servlet.DwrServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
     &lt;param-name>jsonpEnabled&lt;/param-name&gt;
     &lt;param-value>true&lt;/param-value&gt;
    &lt;/init-param&gt;
    ...	
    </code></pre>
<h2>dwr.xml</h2>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE dwr PUBLIC
    "-//GetAhead Limited//DTD Direct Web Remoting 2.0//EN"
    "http://getahead.org/dwr/dwr20.dtd"&gt;

&lt;dwr&gt;
  &lt;allow&gt;
    &lt;create creator="new" javascript="Demo"&gt;
      &lt;param name="class" value="org.getahead.dwrdemo.simpletext.Demo"/&gt;
    &lt;/create&gt;
  &lt;/allow&gt;
&lt;/dwr&gt;
</pre>
</p>
  </div>

</div>

</body>
</html>
